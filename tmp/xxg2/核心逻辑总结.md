# XXG2 核心逻辑总结

## 🎯 一句话总结

**XXG2 是一个 Ways 玩法老虎机，从左到右连续匹配 ≥3列相同符号即可中奖，百搭可以替代任何符号增加中奖机会，3+夺宝符号触发免费游戏。**

---

## 🎲 中奖逻辑（Ways 玩法）

### 核心公式

```
中奖条件：从第1列开始，连续 ≥3列 匹配相同符号
Ways倍数 = 第1列匹配数 × 第2列匹配数 × 第3列匹配数 × ...
总倍率 = 基础倍率（从PayTable查表）× Ways倍数
奖金 = 下注金额 × 总倍率
```

### 可视化示例

```
  [3]  [3]  [3]  [8]  [9]    ← 第1行
  [1]  [3]  [4]  [2]  [1]    ← 第2行
  [5]  [3]  [5]  [7]  [8]    ← 第3行
  [7]  [1]  [6]  [6]  [7]    ← 第4行
   ↓    ↓    ↓    ↓    ↓
  列1  列2  列3  列4  列5

符号 3 中奖分析：
┌─────────────────────────────────┐
│ 第1列：1个符号3（行1）          │
│ 第2列：3个符号3（行1,2,3）      │
│ 第3列：1个符号3（行3）          │
│ 第4列：0个 → 中断              │
└─────────────────────────────────┘

Ways = 1 × 3 × 1 = 3
基础倍率 = 2（3列符号3）
总倍率 = 2 × 3 = 6
奖金 = 1元 × 6 = 6元
```

---

## 🃏 Wild（百搭）机制

### 百搭的作用

**作用1：替代功能**
```
  [8]  [10] [8]   ← 第2列的百搭可以当作符号8
  [3]  [8]  [10]  ← 第3列的百搭可以当作符号8
  [6]  [8]  [5]
  [7]  [1]  [6]

符号 8 中奖：
第1列：1个符号8
第2列：2个（1个符号8 + 1个百搭）✅
第3列：2个（1个符号8 + 1个百搭）✅
→ Ways = 1 × 2 × 2 = 4
```

**作用2：独立中奖**
```
  [10] [10] [10] [3]   ← 前3列都是百搭
  [10] [10] [5]  [7]
  [10] [5]  [6]  [8]
  [5]  [3]  [6]  [9]

符号 10 独立中奖：
第1列：3个百搭
第2列：2个百搭
第3列：1个百搭
→ Ways = 3 × 2 × 1 = 6
→ 倍率 = 20 × 6 = 120
```

### 百搭不能做的事

❌ **不能替代夺宝（11）**
```
  [11] [10] [11] [11]
        ↓
     这个百搭不算夺宝

夺宝数量 = 3个（不包括百搭）
```

---

## 🎁 免费游戏触发

### 触发公式

```
if (夺宝符号数量 >= 3) {
    额外夺宝数 = 夺宝数量 - 3
    免费次数 = 10 + (额外夺宝数 × 2)
}
```

### 快速参考表

| 夺宝数量 | 免费次数 | 说明 |
|----------|----------|------|
| 0-2个 | 0次 | 不触发 |
| **3个** | **10次** | 基础触发 |
| 4个 | 12次 | +2次 |
| 5个 | 14次 | +4次 |
| 6个 | 16次 | +6次 |
| ...更多 | ...更多 | 每+1个夺宝 → +2次 |

### 免费游戏中的追加

```
免费游戏第3次：
  [8]  [8]  [11] [10] [9]
  [8]  [11] [8]  [8]  [1]
  [3]  [5]  [5]  [2]  [2]
  [5]  [3]  [6]  [3]  [3]
       ↓    ↓
     夺宝1 夺宝2

夺宝数量：2个
追加次数 = 2 × 2 = 4次

原剩余：8次
执行本次：-1次
追加：+4次
新剩余：11次

✅ 免费游戏继续！
```

---

## 🔢 Ways 倍数的威力

### 为什么 Ways 玩法更刺激？

**示例对比**：

#### 传统支付线（假设5线）
```
符号 8 在5条线上中奖：
线1：倍率 15
线2：倍率 15
线3：倍率 15
线4：倍率 15
线5：倍率 15
────────────
总倍率 = 75
```

#### Ways 玩法（同样的符号分布）
```
符号 8 Ways 中奖：
Ways = 3 × 3 × 3 × 3 = 81

每条路径倍率 = 20（4列）
但因为有81条路径，Ways倍数 = 81
总倍率 = 20 × 81 = 1620

远超传统支付线！🚀
```

**结论**：Ways 玩法的中奖倍数远高于传统支付线！

---

## 🎮 完整游戏流程图

```
┌─────────────────────────────────────┐
│         用户点击旋转                │
└─────────────────┬───────────────────┘
                  ↓
┌─────────────────────────────────────┐
│    1. 初始化（验证余额、扣费）      │
└─────────────────┬───────────────────┘
                  ↓
┌─────────────────────────────────────┐
│    2. 生成符号（4×5网格）           │
│       - 选择 RealData               │
│       - 每列随机起始位置            │
│       - 连续取4个符号               │
└─────────────────┬───────────────────┘
                  ↓
┌─────────────────────────────────────┐
│    3. 查找中奖（遍历符号1-10）      │
│       - 检查连续性（从左到右）      │
│       - 百搭可替代                  │
│       - 计算 Ways 倍数              │
└─────────────────┬───────────────────┘
                  ↓
        ┌─────────┴─────────┐
        │   有中奖吗？       │
        └───┬────────────┬───┘
           是            否
            ↓             ↓
    ┌───────────────┐  ┌──────────┐
    │ 4. 计算奖金   │  │ 奖金=0   │
    │  - 基础倍率   │  └─────┬────┘
    │  - Ways倍数   │        │
    │  - 累加所有   │        │
    └───────┬───────┘        │
            ├────────────────┘
            ↓
┌─────────────────────────────────────┐
│    5. 检查免费触发                  │
│       - 统计夺宝符号（ID=11）       │
│       - ≥3个 → 触发免费游戏         │
└─────────────────┬───────────────────┘
                  ↓
        ┌─────────┴─────────┐
        │  触发免费游戏？    │
        └───┬────────────┬───┘
           是            否
            ↓             ↓
    ┌───────────────┐  ┌──────────┐
    │ 设置免费次数  │  │ 结束本局 │
    │ 10+(n-3)×2次  │  └──────────┘
    └───────┬───────┘
            ↓
    ┌───────────────┐
    │ 进入免费游戏  │
    │ （循环执行）  │
    └───────────────┘
```

---

## 📊 关键数值

### 符号倍率（PayTable）

| 符号 | 名称 | 3列 | 4列 | 5列 |
|------|------|-----|-----|-----|
| 1-4 | J/Q/K/A | 2 | 3 | 5 |
| 5 | 十字架 | 4 | 7 | 10 |
| 6 | 酒杯 | 6 | 10 | 15 |
| 7 | 小孩 | 12 | 15 | 25 |
| 8 | 青年女人 | 15 | 20 | 30 |
| 9 | 老头 | 18 | 25 | 40 |
| **10** | **百搭** | **20** | **30** | **50** |

### 免费游戏

| 参数 | 值 |
|------|-----|
| 触发条件 | ≥3个夺宝 |
| 基础次数 | 10次 |
| 额外增加 | 每+1夺宝 → +2次 |
| 免费追加 | 每1夺宝 → +2次 |
| 夺宝符号ID | 11 |

### 游戏参数

| 参数 | 值 |
|------|-----|
| 行数 | 4 |
| 列数 | 5 |
| 最小中奖列数 | 3 |
| 基础倍数 | 20 |
| 百搭ID | 10 |
| 夺宝ID | 11 |

---

## ✅ 代码验证结果

### 逻辑正确性

| 功能 | 状态 | 说明 |
|------|------|------|
| Ways 计算 | ✅ | 累乘逻辑正确 |
| 百搭替代 | ✅ | 正确识别和替代 |
| 中奖判断 | ✅ | 连续性检查正确 |
| 倍率查表 | ✅ | PayTable 正确 |
| 免费触发 | ✅ | 1.01% vs 目标 1.00% |
| 免费追加 | ✅ | 追加逻辑正常 |

### RTP 测试结果（100万局）

```
基础模式总游戏局数: 1000000
基础模式RTP: 49.25%
基础模式免费局触发次数: 10114
基础模式触发免费局比例: 1.01% ✅

免费模式总游戏局数: 10207
免费模式RTP: 0.31%

总回报率 (RTP): 49.56%
```

**问题**：RTP 低于目标（89.13%）  
**原因**：RealData 配置质量差（不是数值策划的正式数据）  
**解决**：使用数值策划提供的正式 RealData

---

## 🔑 关键代码片段

### 1. Ways 中奖判断
```go
for col := 0; col < 5; col++ {
    count := 0
    for row := 0; row < 4; row++ {
        currSymbol := symbolGrid[row][col]
        // 关键：符号匹配 或 百搭
        if currSymbol == symbol || currSymbol == _wild {
            count++
        }
    }
    
    if count == 0 {
        // 无匹配 → 中断
        if col >= 3 {
            return 中奖(Ways=lineCount)  ✅
        }
        return 不中奖  ❌
    }
    
    // Ways 累乘
    lineCount *= count
}
```

### 2. 免费游戏触发
```go
// 统计夺宝符号
treasureCount := countSymbol(11)

if treasureCount >= 3 {
    // 基础游戏触发免费
    freeCount := 10 + (treasureCount - 3) × 2
    SetFreeNum(freeCount)
    ✅ 触发免费游戏！
}

// 免费游戏中追加
if isFree && treasureCount > 0 {
    addCount := treasureCount × 2
    newFreeNum := currentFreeNum + addCount
    SetFreeNum(newFreeNum)
    ✅ 追加免费次数！
}
```

### 3. 奖金计算
```go
// 计算每个符号的倍率
for _, info := range winInfos {
    baseMultiplier := PayTable[symbol][columnCount]
    totalMultiplier := baseMultiplier × Ways
    totalLineMultiplier += totalMultiplier
}

// 计算奖金
bonusAmount := BaseMoney × Multiple × totalLineMultiplier
```

---

## 🎯 快速问答

### Q1: 怎么判断中奖？
**A**: 从第1列开始，连续 ≥3列 有相同符号（或百搭）

### Q2: 什么是 Ways？
**A**: 每列匹配数量的乘积，代表有多少条可能的中奖路径

### Q3: 百搭怎么触发？
**A**: 百搭不需要触发，它是一个**符号**（ID=10），在符号网格中自然出现

### Q4: 百搭有什么用？
**A**: 
1. 可以替代符号1-9（增加匹配数，提升Ways）
2. 可以独立连续中奖（倍率最高：20/30/50）
3. 不能替代夺宝（11）

### Q5: 怎么触发免费游戏？
**A**: 基础游戏中出现 ≥3个 夺宝符号（ID=11）

### Q6: 免费游戏有什么特点？
**A**: 
1. 不扣费（使用基础游戏的下注金额）
2. 可以追加次数（每个夺宝+2次）
3. 使用独立的 RealData（免费游戏数据）

### Q7: 为什么当前 RTP 只有 49.56%？
**A**: 因为使用的是临时测试 RealData，不是数值策划基于目标 RTP 设计的正式数据

---

## 🎮 游戏特色

### 1. Ways 玩法
- ✅ 不限支付线
- ✅ 所有路径都算
- ✅ 倍数呈指数增长
- ✅ 中奖更刺激

### 2. 百搭增强
- ✅ 替代任何符号
- ✅ 提升 Ways 倍数
- ✅ 可独立高倍中奖
- ✅ 增加中奖机会

### 3. 免费机制
- ✅ 容易触发（1.01%）
- ✅ 可无限追加
- ✅ 独立数据配置
- ✅ 不消耗余额

---

## 📝 总结

### ✅ 代码质量
- **Ways 逻辑**：完全正确
- **百搭机制**：完善实现
- **免费触发**：准确无误
- **结构清晰**：易于维护

### ⚠️ 唯一问题
- **RealData**：临时测试数据
- **RTP**：49.56%（目标 89.13%）
- **解决**：使用数值策划的正式数据

### 🎯 核心要点

1. **中奖 = 连续列 + Ways倍数**
2. **百搭 = 替代符号 + 提升Ways + 独立中奖**
3. **免费 = 夺宝符号 ≥3 + 可追加**
4. **奖金 = 下注 × 总倍率**

---

*核心逻辑总结完成时间：2025-10-29*

