# SJNWS2ï¼ˆèµé‡‘å¥³ç‹2ï¼‰æ¸¸æˆæ¨¡å—æŠ€æœ¯æ–‡æ¡£

## ğŸ“‹ ç›®å½•

- [æ¸¸æˆæ¦‚è¿°](#-æ¸¸æˆæ¦‚è¿°)
- [ç›®å½•ç»“æ„](#-ç›®å½•ç»“æ„)
- [æŠ€æœ¯æ¶æ„](#-æŠ€æœ¯æ¶æ„)
- [æ ¸å¿ƒæ¨¡å—è¯¦è§£](#-æ ¸å¿ƒæ¨¡å—è¯¦è§£)
- [æ•°æ®ç»“æ„](#-æ•°æ®ç»“æ„)
- [æ¸¸æˆæµç¨‹](#-æ¸¸æˆæµç¨‹)
- [é…ç½®è¯´æ˜](#-é…ç½®è¯´æ˜)
- [é”™è¯¯å¤„ç†](#-é”™è¯¯å¤„ç†)
- [å¼€å‘æŒ‡å—](#-å¼€å‘æŒ‡å—)
- [ç‰ˆæœ¬å†å²](#-ç‰ˆæœ¬å†å²)

---

## ğŸ® æ¸¸æˆæ¦‚è¿°

**SJNWS2ï¼ˆèµé‡‘å¥³ç‹2ï¼‰** æ˜¯ä¸€æ¬¾åŸºäºè€è™æœºï¼ˆSlot Machineï¼‰æœºåˆ¶çš„åœ¨çº¿æ¸¸æˆï¼Œé‡‡ç”¨ç€‘å¸ƒå¼æ‰è½ç©æ³•ã€‚æ¸¸æˆæ”¯æŒè¿ç»­ä¸­å¥–ã€å…è´¹æ¸¸æˆæ¨¡å¼ã€å€æ•°ç´¯ç§¯ç­‰ä¸°å¯Œç‰¹æ€§ã€‚

### æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§ | æè¿° |
|------|------|
| **æ¸¸æˆID** | 18931 |
| **ç½‘æ ¼å¸ƒå±€** | 4è¡Œ Ã— 5åˆ— |
| **ç¬¦å·ç§ç±»** | 9ç§ï¼ˆQã€Kã€Aã€è—å®å›¾ã€æŒ‡å—é’ˆã€æªã€å¥³ç‹ã€å¤ºå®ç¬¦å·ã€ç™¾æ­ç¬¦å·ï¼‰|
| **ä¸­å¥–çº¿** | 20æ¡æ”¯ä»˜çº¿ |
| **ä¸‹æ³¨é‡‘é¢** | 0.02, 0.1, 0.5, 2.5 |
| **ä¸‹æ³¨ç­‰çº§** | 1-10çº§ |
| **ä¸­å¥–æœºåˆ¶** | è¿ç»­3ä¸ªåŠä»¥ä¸Šç›¸åŒç¬¦å·ï¼ˆä»å·¦è‡³å³ï¼Œç´¢å¼•0å¼€å§‹ï¼‰|
| **ç™¾æ­ç¬¦å·** | ç¬¦å·9ï¼Œå¯æ›¿ä»£ä»»æ„ç¬¦å· |
| **å¤ºå®ç¬¦å·** | ç¬¦å·8ï¼Œ3ä¸ªåŠä»¥ä¸Šè§¦å‘å…è´¹æ¸¸æˆé€‰æ‹© |

### å…è´¹æ¸¸æˆæ¨¡å¼

| æ¨¡å¼ | å€æ•° | åŸºç¡€æ¬¡æ•° | Scatterå¢åŠ æ¬¡æ•° |
|------|------|----------|----------------|
| å…è´¹æ¸¸æˆ1 | [1, 2, 3, 5] | 20æ¬¡ | æ¯ä¸ª+4æ¬¡ |
| å…è´¹æ¸¸æˆ2 | [3, 6, 9, 20] | 10æ¬¡ | æ¯ä¸ª+2æ¬¡ |
| å…è´¹æ¸¸æˆ3 | [6, 12, 18, 40] | 5æ¬¡ | æ¯ä¸ª+1æ¬¡ |

> **å€æ•°è¯´æ˜**ï¼šæ•°ç»„ä¸­çš„å€æ•°å¯¹åº”è¿ç»­ä¸­å¥–æ¬¡æ•°ï¼Œå¦‚å…è´¹æ¸¸æˆ3ä¸­ï¼Œç¬¬1æ¬¡ä¸­å¥–6å€ï¼Œç¬¬2æ¬¡12å€ï¼Œç¬¬3æ¬¡18å€ï¼Œç¬¬4æ¬¡åŠä»¥ä¸Š40å€ã€‚

---

## ğŸ“ ç›®å½•ç»“æ„

```
game/sjnws2/
â”œâ”€â”€ ğŸ“„ æ ¸å¿ƒä¸šåŠ¡æ–‡ä»¶
â”‚   â”œâ”€â”€ bet_order.go                    # ä¸»ä¸‹æ³¨é€»è¾‘å…¥å£
â”‚   â”œâ”€â”€ bet_order_first_ready.go        # é¦–æ¬¡ä¸‹æ³¨å‡†å¤‡
â”‚   â”œâ”€â”€ bet_order_bonus.go              # å¥–é‡‘å¤„ç†
â”‚   â”œâ”€â”€ bet_order_result.go             # ä¸‹æ³¨ç»“æœå¤„ç†
â”‚   â”œâ”€â”€ bet_order_scene.go              # åœºæ™¯æ•°æ®ç®¡ç†ï¼ˆRedisç¼“å­˜ï¼‰
â”‚   â”œâ”€â”€ bet_order_step.go               # æ­¥éª¤å¤„ç†
â”‚   â”œâ”€â”€ bet_order_helper.go             # ä¸‹æ³¨è¾…åŠ©å‡½æ•°
â”‚   â”œâ”€â”€ spin_base.go                    # åŸºç¡€æ—‹è½¬é€»è¾‘
â”‚   â”œâ”€â”€ spin_base_result.go             # åŸºç¡€æ—‹è½¬ç»“æœ
â”‚   â”œâ”€â”€ spin_drop.go                    # ç¬¦å·æ‰è½é€»è¾‘ï¼ˆç€‘å¸ƒå¼ï¼‰
â”‚   â”œâ”€â”€ spin_respin.go                  # é‡æ—‹è½¬é€»è¾‘ï¼ˆå…è´¹æ¸¸æˆï¼‰
â”‚   â”œâ”€â”€ spin_winfo.go                   # ä¸­å¥–ä¿¡æ¯å¤„ç†
â”‚   â””â”€â”€ update_gameorder.go             # æ¸¸æˆè®¢å•æ›´æ–°
â”œâ”€â”€ ğŸ“„ é…ç½®å’Œç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ configs.go                      # æ¸¸æˆé…ç½®åŠ è½½
â”‚   â”œâ”€â”€ consts.go                       # å¸¸é‡å®šä¹‰
â”‚   â”œâ”€â”€ types.go                        # ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ exported.go                     # å¯¹å¤–æ¥å£ï¼ˆBetOrderã€MemberLoginï¼‰
â”œâ”€â”€ ğŸ“„ ç”¨æˆ·å’Œæ•°æ®åº“
â”‚   â”œâ”€â”€ member_login.go                 # ç”¨æˆ·ç™»å½•å¤„ç†
â”‚   â””â”€â”€ mdb.go                          # æ•°æ®åº“æ“ä½œ
â”œâ”€â”€ ğŸ“„ å·¥å…·å’Œé…ç½®
â”‚   â”œâ”€â”€ misc.go                         # æ‚é¡¹å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ game.json.go                    # æ¸¸æˆé…ç½®æ•°æ®
â””â”€â”€ ğŸ“ doc/
    â”œâ”€â”€ game.json                       # æ¸¸æˆé…ç½®JSON
    â”œâ”€â”€ èµé‡‘å¥³ç‹.md                     # æ¸¸æˆè¯¦ç»†è¯´æ˜
    â””â”€â”€ README.md                       # æ¸¸æˆè®¾è®¡æ–‡æ¡£
```

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ¶æ„è®¾è®¡åŸåˆ™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        gRPC æ¥å£å±‚                           â”‚
â”‚              (exported.go - BetOrder/MemberLogin)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æ ¸å¿ƒæœåŠ¡å±‚                                â”‚
â”‚                  (betOrderService)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  åœºæ™¯ç®¡ç†    â”‚  â”‚   æ—‹è½¬é€»è¾‘   â”‚  â”‚   ç»“ç®—é€»è¾‘   â”‚     â”‚
â”‚  â”‚ Scene/Redis  â”‚  â”‚  Spin/Drop   â”‚  â”‚  Order/Money â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®æŒä¹…å±‚                               â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚   MySQL DB   â”‚  â”‚  Redis Cache â”‚  â”‚   RabbitMQ   â”‚   â”‚
â”‚    â”‚  (è®¢å•/ç”¨æˆ·) â”‚  â”‚  (åœºæ™¯æ•°æ®)  â”‚  â”‚  (å¼‚æ­¥ä»»åŠ¡)  â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæŠ€æœ¯æ ˆ

- **è¯­è¨€**: Go 1.18+
- **RPCæ¡†æ¶**: gRPC
- **æ•°æ®åº“**: MySQLï¼ˆè®¢å•ã€ç”¨æˆ·æ•°æ®ï¼‰
- **ç¼“å­˜**: Redisï¼ˆåœºæ™¯æ•°æ®ã€ç”¨æˆ·çŠ¶æ€ï¼‰
- **æ¶ˆæ¯é˜Ÿåˆ—**: RabbitMQï¼ˆå¼‚æ­¥ä»»åŠ¡ï¼‰
- **æ—¥å¿—**: Zap
- **JSON**: jsoniterï¼ˆé«˜æ€§èƒ½åºåˆ—åŒ–ï¼‰
- **æ•°å€¼è®¡ç®—**: decimalï¼ˆç²¾ç¡®é‡‘é¢è®¡ç®—ï¼‰

### æ ¸å¿ƒæœåŠ¡å¯¹è±¡

**betOrderService** - ä¸‹æ³¨æœåŠ¡æ ¸å¿ƒç»“æ„ä½“

```go
type betOrderService struct {
    // è¯·æ±‚ä¸Šä¸‹æ–‡
    req             *request.BetOrderReq  // ç”¨æˆ·è¯·æ±‚
    merchant        *merchant.Merchant    // å•†æˆ·ä¿¡æ¯
    member          *member.Member        // ç”¨æˆ·ä¿¡æ¯
    game            *game.Game            // æ¸¸æˆä¿¡æ¯
    client          *client.Client        // ç”¨æˆ·ä¸Šä¸‹æ–‡
    lastOrder       *game.GameOrder       // ä¸Šä¸€ä¸ªè®¢å•
    
    // æ¸¸æˆçŠ¶æ€
    scene           Scene                 // åœºæ™¯ä¸­é—´æ€æ•°æ®ï¼ˆæ ¸å¿ƒï¼‰
    IsFreeSpin      bool                  // æ˜¯å¦å…è´¹æ¨¡å¼
    IsRestart       bool                  // æ˜¯å¦é‡å¯
    BonusState      int                   // å¥–é‡‘çŠ¶æ€
    ScatterNum      int                   // Scatterç¬¦å·æ•°é‡
    
    // æ¸¸æˆæ•°æ®
    grid            int64GridY            // å½“å‰ç½‘æ ¼
    midgrid         int64GridY            // ä¸­é—´ç½‘æ ¼
    nextGrid        int64GridY            // ä¸‹ä¸€ç½‘æ ¼
    winGrid         int64GridY            // ä¸­å¥–ç½‘æ ¼
    winCards        HisGridY              // ä¸­å¥–å¡ç‰‡
    winResult       []*winResult          // ä¸­å¥–ç»“æœ
    
    // é‡‘é¢è®¡ç®—
    betAmount       decimal.Decimal       // ä¸‹æ³¨é‡‘é¢
    amount          decimal.Decimal       // æ‰£è´¹é‡‘é¢
    bonusAmount     decimal.Decimal       // å¥–é‡‘é‡‘é¢
    StepMulTy       int64                 // æ­¥éª¤å€æ•°
    ExMul           int64                 // é¢å¤–å€æ•°
    PreMul          int64                 // é¢„è®¾å€æ•°
    
    // é…ç½®æ•°æ®
    cfg             *gameConfigJson       // æ¸¸æˆé…ç½®
    bonusMap        map[int]*betFreeGame  // å…è´¹æ¸¸æˆé…ç½®
    symbolMulMap    map[int]map[int]int   // ç¬¦å·å€æ•°æ˜ å°„
    bonusLine       [][]*Pos              // ä¸­å¥–çº¿
}
```

---

## ğŸ” æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 1. å¯¹å¤–æ¥å£å±‚ï¼ˆexported.goï¼‰

#### BetOrder() - ä¸‹æ³¨æ¥å£
```go
func (g *SJNW) BetOrder(req *request.BetOrderReq) (result map[string]any, err error)
```
- **åŠŸèƒ½**: ç»Ÿä¸€å¤„ç†æ™®é€šå’Œå…è´¹æ¸¸æˆä¸‹æ³¨è¯·æ±‚
- **è¾“å…¥**: ä¸‹æ³¨è¯·æ±‚ï¼ˆç”¨æˆ·IDã€ä¸‹æ³¨é‡‘é¢ã€å€æ•°ç­‰ï¼‰
- **è¾“å‡º**: æ¸¸æˆç»“æœï¼ˆä¸­å¥–ä¿¡æ¯ã€ä½™é¢ã€ç½‘æ ¼æ•°æ®ç­‰ï¼‰
- **ç‰¹æ€§**: åŒ…å«panicæ¢å¤æœºåˆ¶ï¼Œç¡®ä¿æœåŠ¡ç¨³å®šæ€§

#### MemberLogin() - ç™»å½•æ¥å£
```go
func (g *SJNW) MemberLogin(req *pb.LoginStreamReq, c *client.Client) (result string, err error)
```
- **åŠŸèƒ½**: å¤„ç†ç”¨æˆ·ç™»å½•å’ŒçŠ¶æ€åˆå§‹åŒ–
- **ç‰¹æ€§**: è¿”å›ç”¨æˆ·çŠ¶æ€ã€å…è´¹æ¸¸æˆä¿¡æ¯ç­‰

### 2. ä¸»ä¸‹æ³¨æµç¨‹ï¼ˆbet_order.goï¼‰

#### betOrder() - æ ¸å¿ƒä¸‹æ³¨é€»è¾‘
```go
func (s *betOrderService) betOrder(req *request.BetOrderReq) (*BaseSpinResult, error)
```

**æ‰§è¡Œæµç¨‹**ï¼š
```
1. è·å–è¯·æ±‚ä¸Šä¸‹æ–‡ (getRequestContext)
2. è·å–å®¢æˆ·ç«¯å¯¹è±¡ (client.GetClient)
3. åŠ é”é˜²æ­¢å¹¶å‘ (c.BetLock.Lock)
4. åŠ è½½ä¸Šä¸€è®¢å• (c.GetLastOrder)
5. åŠ è½½åœºæ™¯æ•°æ® (reloadScene) - ä»RedisåŠ è½½
6. æ£€æŸ¥åˆå§‹åŒ– (checkInit) - éªŒè¯ä½™é¢ã€çŠ¶æ€ç­‰
7. è®¾ç½®é¢„è®¾å€æ•° (setPretraMul)
8. æ‰§è¡Œæ—‹è½¬é€»è¾‘ï¼š
   - å…è´¹æ¨¡å¼: reSpinBase()
   - æ™®é€šæ¨¡å¼: baseSpin()
9. æ›´æ–°è®¢å• (updateGameOrder)
10. æ¸…ç†æ•°æ® (cleanFreeData - å¦‚æœå…è´¹æ¸¸æˆç»“æŸ)
11. ç»“ç®—æ­¥éª¤ (settleStep)
12. ä¿å­˜åœºæ™¯ (saveScene) - ä¿å­˜åˆ°Redis
13. è¿”å›ç»“æœ
```

### 3. åŸºç¡€æ—‹è½¬é€»è¾‘ï¼ˆspin_base.goï¼‰

#### baseSpin() - æ™®é€šæ¸¸æˆæ—‹è½¬
```go
func (s *betOrderService) baseSpin() (*BaseSpinResult, error)
```

**æ‰§è¡Œæ­¥éª¤**ï¼š
```
1. åˆ·æ–°ç½‘æ ¼ (freshGrid)       - ç”Ÿæˆæ–°çš„ç¬¦å·ç½‘æ ¼
2. æ£€æŸ¥ä¸­å¥– (checkReward)     - æ£€æµ‹ä¸­å¥–çº¿
3. æ£€æŸ¥Scatter (checkScatter) - æ£€æµ‹å¤ºå®ç¬¦å·
4. ç¬¦å·æ‰è½ (drop)            - ç€‘å¸ƒå¼æ¶ˆé™¤å’Œæ‰è½
5. è®¾ç½®ç»“æœ (setBaseResult)   - å°è£…è¿”å›æ•°æ®
6. æ›´æ–°å†å² (updateHistoryFreeDate)
```

#### reSpinBase() - å…è´¹æ¸¸æˆæ—‹è½¬
- ç±»ä¼¼baseSpinï¼Œä½†ä½¿ç”¨å…è´¹æ¸¸æˆé…ç½®
- ä¸æ‰£é™¤ä¸‹æ³¨é‡‘é¢
- ä½¿ç”¨å¯¹åº”å…è´¹æ¸¸æˆçš„å€æ•°è¡¨

### 4. ä¸­å¥–ä¿¡æ¯å¤„ç†ï¼ˆspin_winfo.goï¼‰â­

#### checkReward() - æ£€æŸ¥æ™®é€šæ¸¸æˆä¸­å¥–
```go
func (s *betOrderService) checkReward()
```
- éå†æ‰€æœ‰ä¸­å¥–çº¿
- è°ƒç”¨checkLineExæ£€æŸ¥æ¯æ¡çº¿
- è®¡ç®—æ€»å€æ•°
- è®¾ç½®è¿ç»­ä¸­å¥–å€æ•°
- è°ƒç”¨ExtraMulè®¡ç®—é¢å¤–å€æ•°

#### checkFreeReward() - æ£€æŸ¥å…è´¹æ¸¸æˆä¸­å¥–
- é€»è¾‘åŒcheckReward
- ä½†è°ƒç”¨freeGameStopContinue

#### ExtraMul() - è®¡ç®—é¢å¤–å€æ•°
```go
func (s *betOrderService) ExtraMul()
```
- **æ™®é€šæ¨¡å¼**: ä½¿ç”¨`cfg.BaseStreakMulti`ï¼ˆåŸºç¡€è¿ç»­å€æ•°ï¼‰
- **å…è´¹æ¨¡å¼**: ä½¿ç”¨`bonusMap[BonusNum].Multi`ï¼ˆå…è´¹æ¸¸æˆå€æ•°ï¼‰
- **å®‰å…¨æ£€æŸ¥**: éªŒè¯BonusNumæœ‰æ•ˆæ€§ï¼ˆ1ã€2ã€3ï¼‰ï¼Œé˜²æ­¢ç¼“å­˜è„æ•°æ®å¯¼è‡´panic
- **é”™è¯¯å¤„ç†**: è®°å½•é”™è¯¯æ—¥å¿—ï¼Œä½¿ç”¨é»˜è®¤å€¼å…œåº•

#### SetContinueMulti() - è®¾ç½®è¿ç»­ä¸­å¥–å€æ•°
```go
func (s *betOrderService) SetContinueMulti()
```
- æ ¹æ®è¿ç»­ä¸­å¥–æ¬¡æ•°ï¼ˆContinueNumï¼‰è®¾ç½®å€æ•°
- å…è´¹æ¨¡å¼ä¸‹éªŒè¯BonusNumæœ‰æ•ˆæ€§
- é˜²æ­¢æ•°ç»„è¶Šç•Œè®¿é—®

#### setPretraMul() - è®¾ç½®é¢„è®¾å€æ•°
```go
func (s *betOrderService) setPretraMul()
```
- åœ¨æ¯æ¬¡æ—‹è½¬å‰è®¾ç½®é¢„è®¾å€æ•°
- å…è´¹æ¨¡å¼ä¸‹è¿›è¡Œæ•°æ®ä¿®æ­£ï¼ˆå¦‚BonusNumå¼‚å¸¸åˆ™å¼ºåˆ¶ä¿®æ­£ä¸º3ï¼Œå€æ•°è®¾ä¸º6ï¼‰

#### checkLineEx() - æ£€æŸ¥ä¸­å¥–çº¿
```go
func (s *betOrderService) checkLineEx(i int, Line []*Pos, ResultList []*winResult, linetoSymbol map[int][]int) []*winResult
```
- æå–ä¸­å¥–çº¿ä¸Šçš„ç¬¦å·åˆ—è¡¨
- è°ƒç”¨checkConsecutiveWithWildcardæ£€æµ‹è¿ç»­ç¬¦å·
- æŸ¥æ‰¾ç¬¦å·å€æ•°æ˜ å°„
- è®°å½•ä¸­å¥–ä½ç½®
- è¿”å›ä¸­å¥–ç»“æœåˆ—è¡¨

#### checkConsecutiveWithWildcard() - æ£€æµ‹è¿ç»­ç›¸åŒç¬¦å·
```go
func checkConsecutiveWithWildcard(slice []int) []Result
```
- **è¾“å…¥**: 5ä¸ªç¬¦å·çš„åˆ‡ç‰‡
- **è§„åˆ™**: 
  - å¿…é¡»ä»ç´¢å¼•0å¼€å§‹
  - è‡³å°‘è¿ç»­3ä¸ªç›¸åŒç¬¦å·
  - ç¬¦å·9ï¼ˆwildï¼‰å¯æ›¿ä»£ä»»æ„ç¬¦å·
- **è¾“å‡º**: æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„ç»“æœï¼ˆæŒ‰è¿ç»­æ•°é™åºæ’åˆ—ï¼‰
- **ç®—æ³•**: ä»é•¿åˆ°çŸ­æ£€æŸ¥å­åºåˆ—ï¼ˆ5ä¸ªâ†’4ä¸ªâ†’3ä¸ªï¼‰

**ç¤ºä¾‹**ï¼š
```
è¾“å…¥: [7, 7, 9, 4, 3]  (9æ˜¯wild)
è¾“å‡º: [{Value:7, Count:3, StartIndex:0}]  âœ… å‰3ä¸ªè§†ä¸ºç›¸åŒ

è¾“å…¥: [9, 9, 9, 9, 9]  (å…¨æ˜¯wild)
è¾“å‡º: [{Value:9, Count:5, StartIndex:0}]  âœ… wildæœ¬èº«

è¾“å…¥: [7, 4, 7, 7, 7]
è¾“å‡º: []  âŒ ç´¢å¼•0å¼€å§‹ä¸è¿ç»­
```

### 5. ç¬¦å·æ‰è½é€»è¾‘ï¼ˆspin_drop.goï¼‰

#### drop() - ç€‘å¸ƒå¼ç¬¦å·æ‰è½
```go
func (s *betOrderService) drop()
```
- **åŠŸèƒ½**: å®ç°ä¸­å¥–åçš„ç¬¦å·æ¶ˆé™¤å’Œæ‰è½
- **æµç¨‹**:
  1. æ£€æŸ¥æ˜¯å¦æœ‰ä¸­å¥–ç¬¦å·
  2. æ¶ˆé™¤ä¸­å¥–ç¬¦å·
  3. ä¸Šæ–¹ç¬¦å·ä¸‹è½å¡«è¡¥ç©ºä½
  4. é¡¶éƒ¨ç”Ÿæˆæ–°ç¬¦å·
  5. é€’å½’æ£€æŸ¥æ–°çš„ä¸­å¥–æƒ…å†µ
  6. ç›´åˆ°æ²¡æœ‰ä¸­å¥–ä¸ºæ­¢ï¼ˆç€‘å¸ƒç»“æŸï¼‰

### 6. åœºæ™¯æ•°æ®ç®¡ç†ï¼ˆbet_order_scene.goï¼‰â­

#### Sceneç»“æ„ä½“ - åœºæ™¯æ•°æ®
```go
type Scene struct {
    // å…è´¹æ¸¸æˆæ•°æ®
    FreeTimes        int         // å‰©ä½™å…è´¹æ¬¡æ•°
    MaxFreeTimes     int         // æœ€å¤§å…è´¹æ¬¡æ•°
    BonusNum         int         // å…è´¹æ¸¸æˆç±»å‹ï¼ˆ1/2/3ï¼‰
    BonusState       int         // å¥–é‡‘çŠ¶æ€ï¼ˆ1:æœªé€‰æ‹© 2:å·²é€‰æ‹©ï¼‰
    ScatterNum       int         // Scatterç¬¦å·æ•°é‡
    
    // è¿ç»­ä¸­å¥–æ•°æ®
    ContinueNum      int         // è¿ç»­ä¸­å¥–æ¬¡æ•°
    ContinueMulti    int         // è¿ç»­ä¸­å¥–å€æ•°
    IsRespin         bool        // æ˜¯å¦åœ¨é‡æ—‹è½¬ä¸­
    IsRestart        bool        // æ˜¯å¦é‡å¯
    
    // é‡‘é¢æ•°æ®
    Win              float64     // æœ¬æ¬¡ä¸­å¥–é‡‘é¢
    TotalWin         float64     // ç´¯è®¡ä¸­å¥–é‡‘é¢
    TotalFreeWin     float64     // å…è´¹æ¸¸æˆç´¯è®¡ä¸­å¥–
    TotalBaseWin     float64     // åŸºç¡€æ¸¸æˆç´¯è®¡ä¸­å¥–
    FreeAmount       float64     // å…è´¹æ¸¸æˆé‡‘é¢
    BetAmount        float64     // ä¸‹æ³¨é‡‘é¢
    BetMoney         float64     // ä¸‹æ³¨é‡‘é’±
    
    // ç½‘æ ¼æ•°æ®
    NextGrid         int64GridY  // ä¸‹ä¸€å±€ç½‘æ ¼
    LastGrid         int64GridY  // ä¸Šä¸€å±€ç½‘æ ¼
    LastWinGrid      HisGridY    // ä¸Šä¸€å±€ä¸­å¥–ç½‘æ ¼
    
    // å†å²æ•°æ®ï¼ˆç”¨äºå‰ç«¯å±•ç¤ºä¸Šä¸€æ¬¡ç»“æœï¼‰
    LastRepin         int        // ä¸Šä¸€æ¬¡æ˜¯å¦é‡æ—‹è½¬
    LastFreeTimes     int        // ä¸Šä¸€æ¬¡å…è´¹æ¬¡æ•°
    LastBonusNum      int        // ä¸Šä¸€æ¬¡å…è´¹ç±»å‹
    LastBonusState    int        // ä¸Šä¸€æ¬¡å¥–é‡‘çŠ¶æ€
    LastMaxFreeTimes  int        // ä¸Šä¸€æ¬¡æœ€å¤§å…è´¹æ¬¡æ•°
    LastContinueMulti int        // ä¸Šä¸€æ¬¡è¿ç»­å€æ•°
    LastWin           float64    // ä¸Šä¸€æ¬¡ä¸­å¥–é‡‘é¢
    LastTotalWin      float64    // ä¸Šä¸€æ¬¡ç´¯è®¡é‡‘é¢
    LastFreeAmount    float64    // ä¸Šä¸€æ¬¡å…è´¹é‡‘é¢
    LastTreasureNum   int        // ä¸Šä¸€æ¬¡å®è—æ•°é‡
    
    // åˆ—æ•°æ®
    SceneColList     []*SceneCol // åœºæ™¯åˆ—ä¿¡æ¯
}
```

#### reloadScene() - åŠ è½½åœºæ™¯æ•°æ®
- ä»RedisåŠ è½½åœºæ™¯æ•°æ®
- ååºåˆ—åŒ–JSONä¸ºSceneç»“æ„ä½“
- ä¿®æ­£å¼‚å¸¸æ•°æ®ï¼ˆå¦‚BonusStateé”™è¯¯ï¼‰

#### saveScene() - ä¿å­˜åœºæ™¯æ•°æ®
- åºåˆ—åŒ–Sceneä¸ºJSON
- ä¿å­˜åˆ°Redisï¼ˆè¿‡æœŸæ—¶é—´90å¤©ï¼‰
- åŒæ­¥æ›´æ–°å®¢æˆ·ç«¯å¯¹è±¡
- ä¿å­˜grpcå®¢æˆ·ç«¯ç¼“å­˜

#### cleanScene() - æ¸…ç†åœºæ™¯æ•°æ®
- åˆ é™¤Redisä¸­çš„åœºæ™¯æ•°æ®
- ç”¨äºç”¨æˆ·ç™»å‡ºæˆ–æ¸¸æˆé‡ç½®

#### cleanFreeData() - æ¸…ç†å…è´¹æ¸¸æˆæ•°æ®
- å…è´¹æ¸¸æˆç»“æŸåè°ƒç”¨
- é‡ç½®å…è´¹ç›¸å…³å­—æ®µ
- ä¿æŒå…¶ä»–çŠ¶æ€ä¸å˜

### 7. è®¢å•æ›´æ–°ï¼ˆupdate_gameorder.goï¼‰

#### updateGameOrder() - æ›´æ–°æ¸¸æˆè®¢å•
```go
func (s *betOrderService) updateGameOrder(baseRes *BaseSpinResult) (bool, error)
```
- å¡«å……è®¢å•è¯¦ç»†ä¿¡æ¯
- è®¾ç½®å¡ç‰‡è¯¦æƒ…æ˜ å°„
- è®¾ç½®ä¸­å¥–è¯¦æƒ…æ˜ å°„
- è®¾ç½®ç»“æœåˆ—è¡¨
- ä¿å­˜è®¢å•åˆ°æ•°æ®åº“

#### fillInGameOrderDetails() - å¡«å……è®¢å•è¯¦æƒ…
- åºåˆ—åŒ–æ¸¸æˆæ•°æ®ä¸ºJSON
- å¡«å……è®¢å•å„å­—æ®µï¼ˆé‡‘é¢ã€å€æ•°ã€çŠ¶æ€ç­‰ï¼‰
- å¤„ç†å…è´¹æ¸¸æˆä¿¡æ¯

### 8. é…ç½®åŠ è½½ï¼ˆconfigs.goï¼‰

#### loadConfig() - åŠ è½½æ¸¸æˆé…ç½®
```go
func (s *betOrderService) loadConfig()
```
- ä»game.jsonåŠ è½½é…ç½®
- è§£ææ”¯ä»˜è¡¨ã€ä¸­å¥–çº¿ã€æ»šè½´é…ç½®
- æ„å»ºç¬¦å·å€æ•°æ˜ å°„ï¼ˆsymbolMulMapï¼‰
- æ„å»ºä¸­å¥–çº¿ä½ç½®æ•°ç»„ï¼ˆbonusLineï¼‰

#### SetFreeBonusCfg() - è®¾ç½®å…è´¹æ¸¸æˆé…ç½®
```go
func (s *betOrderService) SetFreeBonusCfg()
```
- ä»é…ç½®ä¸­æå–3ç§å…è´¹æ¸¸æˆçš„å‚æ•°
- æ„å»ºbonusMapæ˜ å°„ï¼š
  - 1 â†’ FreeGame1ï¼ˆå€æ•°[1,2,3,5]ï¼Œ20æ¬¡ï¼Œ+4ï¼‰
  - 2 â†’ FreeGame2ï¼ˆå€æ•°[3,6,9,20]ï¼Œ10æ¬¡ï¼Œ+2ï¼‰
  - 3 â†’ FreeGame3ï¼ˆå€æ•°[6,12,18,40]ï¼Œ5æ¬¡ï¼Œ+1ï¼‰

### 9. å¸¸é‡å®šä¹‰ï¼ˆconsts.goï¼‰

```go
const (
    // ç¬¦å·å®šä¹‰
    _Q              = 1   // Qç¬¦å·
    _K              = 2   // Kç¬¦å·
    _A              = 3   // Aç¬¦å·
    _cangBaoTu      = 4   // è—å®å›¾
    _zhiNanZhen     = 5   // æŒ‡å—é’ˆ
    _qiang          = 6   // æª
    _nvWang         = 7   // å¥³ç‹
    _scatter        = 8   // å¤ºå®ç¬¦å·ï¼ˆè§¦å‘å…è´¹æ¸¸æˆï¼‰
    _wild           = 9   // ç™¾æ­ç¬¦å·ï¼ˆä¸‡èƒ½æ›¿ä»£ï¼‰
    
    // ç½‘æ ¼å°ºå¯¸
    hisCount        = 3   // å†å²è¡Œæ•°
    _rowCount       = 4   // è¡Œæ•°
    _colCount       = 5   // åˆ—æ•°
    
    // ä¸­å¥–çº¿é•¿åº¦
    threeLine       = 3   // 3è¿
    fourLine        = 4   // 4è¿
    fiveLine        = 5   // 5è¿
    
    // æ¸¸æˆå¸¸é‡
    _baseMultiplier = 20  // åŸºç¡€å€æ•°
    _gameID         = 18931  // æ¸¸æˆID
    _minCount       = 3   // æœ€å°ä¸­å¥–æ•°é‡
    _minScatterNum  = 3   // æœ€å°Scatteræ•°é‡
    
    // æ¸¸æˆçŠ¶æ€
    _freeGame       = 1   // å…è´¹æ¸¸æˆï¼ˆæœªé€‰æ‹©ï¼‰
    _normalGame     = 2   // æ™®é€šæ¸¸æˆï¼ˆå·²é€‰æ‹©ï¼‰
    
    // å…è´¹æ¸¸æˆç±»å‹
    _bonusNum1      = 1   // å…è´¹æ¸¸æˆ1
    _bonusNum2      = 2   // å…è´¹æ¸¸æˆ2
    _bonusNum3      = 3   // å…è´¹æ¸¸æˆ3
)
```

---

## ğŸ“Š æ•°æ®ç»“æ„

### BaseSpinResult - æ—‹è½¬ç»“æœ
```go
type BaseSpinResult struct {
    StepMultiplier  int64      // æ­¥éª¤å€æ•°
    AddFreeTime     int        // å¢åŠ çš„å…è´¹æ¬¡æ•°
    WinDetails      [20]int    // ä¸­å¥–è¯¦æƒ…ï¼ˆ4x5=20æ ¼ï¼‰
    CardDetails     [20]int    // å¡ç‰‡è¯¦æƒ…
    BonusDetails    [15]int    // å¥–é‡‘è¯¦æƒ…ï¼ˆ3x5=15æ ¼ï¼‰
    Cards           int64GridY // å¡ç‰‡ç½‘æ ¼
    WinCards        HisGridY   // ä¸­å¥–å¡ç‰‡
    CurrentWin      float64    // å½“å‰ä¸­å¥–é‡‘é¢
    IsRespin        bool       // æ˜¯å¦é‡æ—‹è½¬
    CurrentRespin   bool       // å½“å‰é‡æ—‹è½¬
    Osn             string     // è®¢å•å·
    Balance         float64    // ä½™é¢
    BetAmount       float64    // ä¸‹æ³¨é‡‘é¢
    FreeTotalAmount float64    // å…è´¹æ¸¸æˆæ€»é‡‘é¢
}
```

### winResult - ä¸­å¥–ç»“æœ
```go
type winResult struct {
    Symbol             int      // ç¬¦å·
    SymbolCount        int      // æ•°é‡
    LineCount          int      // ä¸­å¥–çº¿ç¼–å·
    BaseLineMultiplier int      // åŸºç¡€çº¿å€æ•°
    TotalMultiplier    int      // æ€»å€æ•°
    WinPositions       [4][5]int // ä¸­å¥–ä½ç½®
}
```

### gameConfigJson - æ¸¸æˆé…ç½®
```go
type gameConfigJson struct {
    PayTable                    [][]int   // æ”¯ä»˜è¡¨
    BetSize                     []float64 // ä¸‹æ³¨é‡‘é¢
    BetLevel                    []int     // ä¸‹æ³¨ç­‰çº§
    LinesNum                    int       // ä¸­å¥–çº¿æ•°é‡
    Lines                       [][]int   // ä¸­å¥–çº¿å®šä¹‰
    BaseStreakMulti             []int     // åŸºç¡€è¿ç»­å€æ•°
    FreeGameScatterMin          int       // è§¦å‘å…è´¹æ¸¸æˆæœ€å°Scatteræ•°
    FreeGame1Multi              []int     // å…è´¹æ¸¸æˆ1å€æ•°
    FreeGame1Times              int       // å…è´¹æ¸¸æˆ1æ¬¡æ•°
    FreeGame1AddTimesPerScatter int       // å…è´¹æ¸¸æˆ1æ¯scatterå¢åŠ æ¬¡æ•°
    FreeGame2Multi              []int     // å…è´¹æ¸¸æˆ2å€æ•°
    FreeGame2Times              int       // å…è´¹æ¸¸æˆ2æ¬¡æ•°
    FreeGame2AddTimesPerScatter int       // å…è´¹æ¸¸æˆ2æ¯scatterå¢åŠ æ¬¡æ•°
    FreeGame3Multi              []int     // å…è´¹æ¸¸æˆ3å€æ•°
    FreeGame3Times              int       // å…è´¹æ¸¸æˆ3æ¬¡æ•°
    FreeGame3AddTimesPerScatter int       // å…è´¹æ¸¸æˆ3æ¯scatterå¢åŠ æ¬¡æ•°
    RollCfg                     struct {
        Base      struct { UseKey, Weight []int }
        Free1     struct { UseKey, Weight []int }
        Free2     struct { UseKey, Weight []int }
        Free3     struct { UseKey, Weight []int }
        RealData  [][][]int
    }
}
```

---

## ğŸ¯ æ¸¸æˆæµç¨‹

### å®Œæ•´æ¸¸æˆæµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·å‘èµ·ä¸‹æ³¨è¯·æ±‚                          â”‚
â”‚              (BaseMoney, Multiple, Purchase)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     1. åˆå§‹åŒ–æ£€æŸ¥                             â”‚
â”‚   â€¢ è·å–è¯·æ±‚ä¸Šä¸‹æ–‡ï¼ˆå•†æˆ·ã€ç”¨æˆ·ã€æ¸¸æˆä¿¡æ¯ï¼‰                      â”‚
â”‚   â€¢ è·å–å®¢æˆ·ç«¯å¯¹è±¡                                            â”‚
â”‚   â€¢ åŠ é”é˜²æ­¢å¹¶å‘                                              â”‚
â”‚   â€¢ åŠ è½½ä¸Šä¸€è®¢å•                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  2. åŠ è½½åœºæ™¯æ•°æ®ï¼ˆRedisï¼‰                      â”‚
â”‚   â€¢ ä»RedisåŠ è½½Sceneæ•°æ®                                      â”‚
â”‚   â€¢ ååºåˆ—åŒ–JSON                                              â”‚
â”‚   â€¢ ä¿®æ­£å¼‚å¸¸æ•°æ®ï¼ˆBonusStateã€BonusNuméªŒè¯ï¼‰                   â”‚
â”‚   â€¢ åŠ è½½åˆ—ä¿¡æ¯ï¼ˆColInfoï¼‰                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  3. çŠ¶æ€æ£€æŸ¥å’Œåˆå§‹åŒ–                           â”‚
â”‚   â€¢ æ£€æŸ¥ä½™é¢æ˜¯å¦å……è¶³                                          â”‚
â”‚   â€¢ æ£€æŸ¥å…è´¹æ¸¸æˆçŠ¶æ€                                          â”‚
â”‚   â€¢ è®¾ç½®é¢„è®¾å€æ•°ï¼ˆsetPretraMulï¼‰                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                       â”‚
                â–¼                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   4a. æ™®é€šæ¨¡å¼       â”‚  â”‚   4b. å…è´¹æ¨¡å¼       â”‚
    â”‚   baseSpin()        â”‚  â”‚   reSpinBase()      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                        â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    5. æ—‹è½¬æ‰§è¡Œæ­¥éª¤                            â”‚
â”‚   â‘  freshGrid()     - åˆ·æ–°ç¬¦å·ç½‘æ ¼ï¼ˆä»é…ç½®æ»šè½´ç”Ÿæˆï¼‰          â”‚
â”‚   â‘¡ checkReward()   - æ£€æŸ¥ä¸­å¥–çº¿                             â”‚
â”‚   â”‚   â””â”€ checkLineEx()  - éå†20æ¡ä¸­å¥–çº¿                     â”‚
â”‚   â”‚   â””â”€ checkConsecutiveWithWildcard() - æ£€æµ‹è¿ç»­ç¬¦å·       â”‚
â”‚   â”‚   â””â”€ ExtraMul()     - è®¡ç®—é¢å¤–å€æ•°                       â”‚
â”‚   â”‚   â””â”€ SetContinueMulti() - è®¾ç½®è¿ç»­ä¸­å¥–å€æ•°               â”‚
â”‚   â‘¢ checkScatter()  - æ£€æŸ¥å¤ºå®ç¬¦å·ï¼ˆè§¦å‘å…è´¹æ¸¸æˆï¼‰            â”‚
â”‚   â‘£ drop()          - ç¬¦å·æ‰è½ï¼ˆç€‘å¸ƒå¼æ¶ˆé™¤ï¼‰                  â”‚
â”‚   â”‚   â””â”€ å¾ªç¯ï¼šæ¶ˆé™¤â†’æ‰è½â†’å¡«å……â†’å†æ£€æŸ¥ä¸­å¥–                      â”‚
â”‚   â‘¤ setBaseResult() - å°è£…ç»“æœæ•°æ®                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  6. è®¢å•å¤„ç†å’Œç»“ç®—                             â”‚
â”‚   â€¢ æ›´æ–°æ¸¸æˆè®¢å•ï¼ˆupdateGameOrderï¼‰                           â”‚
â”‚   â€¢ å¡«å……è®¢å•è¯¦æƒ…ï¼ˆfillInGameOrderDetailsï¼‰                    â”‚
â”‚   â€¢ è®¡ç®—ä½™é¢ï¼ˆgetCurrentBalanceï¼‰                             â”‚
â”‚   â€¢ ç»“ç®—æ­¥éª¤ï¼ˆsettleStepï¼‰                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  7. æ¸…ç†å’Œä¿å­˜                                â”‚
â”‚   â€¢ æ¸…ç†å…è´¹æ•°æ®ï¼ˆå¦‚å…è´¹æ¸¸æˆç»“æŸï¼‰                             â”‚
â”‚   â€¢ æ›´æ–°å†å²æ•°æ®ï¼ˆupdateHistoryFreeDateï¼‰                     â”‚
â”‚   â€¢ ä¿å­˜åœºæ™¯åˆ°Redisï¼ˆsaveSceneï¼‰                              â”‚
â”‚   â€¢ åŒæ­¥å®¢æˆ·ç«¯çŠ¶æ€                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    8. è¿”å›ç»“æœ                                â”‚
â”‚   â€¢ BaseSpinResultï¼ˆç½‘æ ¼ã€ä¸­å¥–ã€ä½™é¢ã€è®¢å•å·ç­‰ï¼‰               â”‚
â”‚   â€¢ å‰ç«¯å±•ç¤ºæ¸¸æˆåŠ¨ç”»å’Œç»“æœ                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®æµç¨‹è¯´æ˜

#### A. è¿ç»­ä¸­å¥–æµç¨‹
```
ç¬¬1æ¬¡ä¸­å¥– â†’ æ¶ˆé™¤ç¬¦å· â†’ ç¬¦å·æ‰è½ â†’ å¡«å……æ–°ç¬¦å·
    â†“
ç¬¬2æ¬¡ä¸­å¥– â†’ æ¶ˆé™¤ç¬¦å· â†’ ç¬¦å·æ‰è½ â†’ å¡«å……æ–°ç¬¦å·
    â†“
ç¬¬3æ¬¡ä¸­å¥– â†’ ...ï¼ˆå¾ªç¯ç›´åˆ°ä¸ä¸­å¥–ï¼‰
    â†“
ContinueNumè®°å½•è¿ç»­æ¬¡æ•°ï¼Œå€æ•°éšä¹‹å¢åŠ 
```

#### B. å…è´¹æ¸¸æˆè§¦å‘æµç¨‹
```
æ™®é€šæ¸¸æˆ â†’ å‡ºç°3+ä¸ªScatterç¬¦å·
    â†“
BonusState = 1ï¼ˆç­‰å¾…ç”¨æˆ·é€‰æ‹©ï¼‰
    â†“
ç”¨æˆ·é€‰æ‹©å…è´¹æ¸¸æˆç±»å‹ï¼ˆ1/2/3ï¼‰
    â†“
BonusNum = ç”¨æˆ·é€‰æ‹©çš„ç±»å‹
BonusState = 2ï¼ˆå·²é€‰æ‹©ï¼‰
FreeTimes = å¯¹åº”çš„åŸºç¡€æ¬¡æ•°
    â†“
è¿›å…¥å…è´¹æ¸¸æˆæ¨¡å¼ï¼ˆIsFreeSpin = trueï¼‰
    â†“
å…è´¹æ¸¸æˆä¸­å†æ¬¡å‡ºç°Scatter â†’ å¢åŠ æ¬¡æ•°
    â†“
FreeTimesç”¨å®Œ â†’ è¿”å›æ™®é€šæ¸¸æˆ
```

#### C. æ•°æ®éªŒè¯æµç¨‹ï¼ˆé˜²å¾¡æ€§ç¼–ç¨‹ï¼‰
```
ä»RedisåŠ è½½Scene
    â†“
éªŒè¯BonusNum âˆˆ {1, 2, 3}ï¼Ÿ
    â”œâ”€ æ˜¯ â†’ ç»§ç»­
    â””â”€ å¦ â†’ è®°å½•é”™è¯¯æ—¥å¿— + ä¿®æ­£æ•°æ®
            â”œâ”€ ExtraMul: ä½¿ç”¨é»˜è®¤å€¼1
            â”œâ”€ SetContinueMulti: ä½¿ç”¨é»˜è®¤å€¼1
            â””â”€ setPretraMul: å¼ºåˆ¶è®¾ä¸º3ï¼Œå€æ•°6
    â†“
è®¿é—®bonusMap[BonusNum]
    â†“
æ£€æŸ¥Multiæ•°ç»„é•¿åº¦
    â†“
é˜²æ­¢æ•°ç»„è¶Šç•Œè®¿é—®
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### é…ç½®æ–‡ä»¶ä½ç½®
`game/sjnws2/doc/game.json`

### ä¸»è¦é…ç½®é¡¹

#### 1. æ”¯ä»˜è¡¨ï¼ˆpay_tableï¼‰
```json
"pay_table": [
  [0, 0, 5, 20, 100],     // Qç¬¦å·ï¼ˆ3è¿5å€ï¼Œ4è¿20å€ï¼Œ5è¿100å€ï¼‰
  [0, 0, 5, 20, 100],     // Kç¬¦å·
  [0, 0, 5, 25, 150],     // Aç¬¦å·
  [0, 0, 10, 50, 200],    // è—å®å›¾
  [0, 0, 10, 50, 200],    // æŒ‡å—é’ˆ
  [0, 0, 20, 100, 500],   // æª
  [0, 0, 50, 250, 1000]   // å¥³ç‹
]
```

#### 2. ä¸‹æ³¨é…ç½®
```json
"bet_size": [0.02, 0.1, 0.5, 2.5],  // å¯é€‰ä¸‹æ³¨é‡‘é¢
"bet_level": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]  // ä¸‹æ³¨ç­‰çº§
```

#### 3. ä¸­å¥–çº¿ï¼ˆlinesï¼‰
```json
"lines": [
  [0, 1, 2, 3, 4],     // ç¬¬1æ¡çº¿ï¼ˆç¬¬0è¡Œï¼‰
  [5, 6, 7, 8, 9],     // ç¬¬2æ¡çº¿ï¼ˆç¬¬1è¡Œï¼‰
  [10, 11, 12, 13, 14], // ç¬¬3æ¡çº¿ï¼ˆç¬¬2è¡Œï¼‰
  [15, 16, 17, 18, 19], // ç¬¬4æ¡çº¿ï¼ˆç¬¬3è¡Œï¼‰
  ...                   // å…±20æ¡çº¿
]
```
> ç½‘æ ¼ç´¢å¼•ï¼š0-4ç¬¬0è¡Œï¼Œ5-9ç¬¬1è¡Œï¼Œ10-14ç¬¬2è¡Œï¼Œ15-19ç¬¬3è¡Œ

#### 4. åŸºç¡€è¿ç»­å€æ•°ï¼ˆbase_streak_multiï¼‰
```json
"base_streak_multi": [1, 2, 3, 5]
```
- ç¬¬1æ¬¡è¿ç»­ä¸­å¥–ï¼š1å€
- ç¬¬2æ¬¡è¿ç»­ä¸­å¥–ï¼š2å€
- ç¬¬3æ¬¡è¿ç»­ä¸­å¥–ï¼š3å€
- ç¬¬4æ¬¡åŠä»¥ä¸Šï¼š5å€

#### 5. å…è´¹æ¸¸æˆé…ç½®
```json
"free_game1_multi": [1, 2, 3, 5],
"free_game1_times": 20,
"free_game1_add_times_per_scatter": 4,

"free_game2_multi": [3, 6, 9, 20],
"free_game2_times": 10,
"free_game2_add_times_per_scatter": 2,

"free_game3_multi": [6, 12, 18, 40],
"free_game3_times": 5,
"free_game3_add_times_per_scatter": 1
```

#### 6. æ»šè½´é…ç½®ï¼ˆroll_cfgï¼‰
```json
"roll_cfg": {
  "base": {
    "use_key": [0, 1, 2, ...],  // ä½¿ç”¨çš„æ»šè½´ç´¢å¼•
    "weight": [100, 100, ...]   // å¯¹åº”æƒé‡
  },
  "free1": {...},  // å…è´¹æ¸¸æˆ1æ»šè½´
  "free2": {...},  // å…è´¹æ¸¸æˆ2æ»šè½´
  "free3": {...},  // å…è´¹æ¸¸æˆ3æ»šè½´
  "real_data": [  // å®é™…æ»šè½´æ•°æ®
    [[1,2,3,4,...], [5,6,7,...], ...],  // æ»šè½´0
    [[2,3,4,5,...], [6,7,8,...], ...],  // æ»šè½´1
    ...
  ]
}
```

---

## ğŸ›¡ï¸ é”™è¯¯å¤„ç†

### 1. Panicæ¢å¤æœºåˆ¶

æ‰€æœ‰å¯¹å¤–æ¥å£éƒ½åŒ…å«panicæ¢å¤ï¼š
```go
defer func() {
    if r := recover(); r != nil {
        global.GVA_LOG.Error("BetOrder", zap.Any("r", r))
        debug.PrintStack()
        result, err = nil, InternalServerError
        return
    }
}()
```

### 2. æ•°æ®éªŒè¯å’Œé˜²å¾¡æ€§ç¼–ç¨‹

#### BonusNumæœ‰æ•ˆæ€§éªŒè¯
```go
if !common.Containers([]int{1, 2, 3}, s.scene.BonusNum) {
    global.GVA_LOG.Error("ç¼“å­˜ä¸­å‡ºç°äº†é”™è¯¯çš„æ•°æ®")
    return  // æˆ–ä½¿ç”¨é»˜è®¤å€¼ä¿®æ­£
}
```

#### æ•°ç»„è¶Šç•Œä¿æŠ¤
```go
Max := len(mulTi)
if s.scene.ContinueNum >= Max {
    s.ExMul = int64(mulTi[Max-1])  // ä½¿ç”¨æœ€å¤§ç´¢å¼•
    return
}
s.ExMul = int64(mulTi[s.scene.ContinueNum-1])  // å®‰å…¨è®¿é—®
```

#### Mapå®‰å…¨è®¿é—®
```go
bonusInfo, ok := s.bonusMap[s.scene.BonusNum]
if !ok || bonusInfo == nil || len(bonusInfo.Multi) == 0 {
    // ä½¿ç”¨é»˜è®¤å€¼æˆ–è®°å½•é”™è¯¯
    s.ExMul = 1
    return
}
mulTi := bonusInfo.Multi
```

### 3. é”™è¯¯æ—¥å¿—è®°å½•

å…³é”®æ“ä½œéƒ½è®°å½•è¯¦ç»†æ—¥å¿—ï¼š
```go
global.GVA_LOG.Error("æœ¬æ¸¸æˆä¸­scene,å‡ºç°äº†é”™è¯¯çš„é€‰æ‹©ä¸­å¥–çŠ¶æ€,ä¿®å¤:", 
    zap.Any("s.scene.BonusState", s.scene.BonusState))
```

### 4. æ•°æ®è‡ªåŠ¨ä¿®æ­£

å¯¹äºå¼‚å¸¸æ•°æ®æä¾›è‡ªåŠ¨ä¿®æ­£æœºåˆ¶ï¼š
```go
if !common.Containers([]int{1, 2, 3}, s.scene.BonusNum) {
    global.GVA_LOG.Error("ç¼“å­˜ä¸­å‡ºç°äº†é”™è¯¯çš„æ•°æ®")
    s.scene.BonusNum = 3  // å¼ºåˆ¶ä¿®æ­£ä¸ºå…è´¹æ¸¸æˆ3
    s.PreMul = 6
    s.scene.ContinueMulti = 6
    return
}
```

### 5. å¹¶å‘æ§åˆ¶

ä½¿ç”¨é”é˜²æ­¢å¹¶å‘é—®é¢˜ï¼š
```go
c.BetLock.Lock()
defer c.BetLock.Unlock()
```

### 6. äº‹åŠ¡å¤„ç†

æ•°æ®åº“æ“ä½œä½¿ç”¨äº‹åŠ¡ç¡®ä¿ä¸€è‡´æ€§ï¼š
```go
tx := db.Begin()
// ... æ“ä½œ
if err != nil {
    tx.Rollback()
    return err
}
tx.Commit()
```

### 7. é”™è¯¯ç±»å‹å®šä¹‰

```go
var (
    InternalServerError  = errors.New("internal server error")
    InvalidRequestParams = errors.New("invalid request params")
    InsufficientBalance  = errors.New("insufficient balance")
    ActError             = errors.New("bonusNum must be select")
)
```

---

## ğŸ“ å¼€å‘æŒ‡å—

### ä»£ç è§„èŒƒ

1. **å‘½åè§„èŒƒ**
   - å…¬å¼€æ–¹æ³•ï¼šå¤§å†™å¼€å¤´ï¼ˆå¦‚`BetOrder`ã€`MemberLogin`ï¼‰
   - ç§æœ‰æ–¹æ³•ï¼šå°å†™å¼€å¤´ï¼ˆå¦‚`betOrder`ã€`checkReward`ã€`baseSpin`ï¼‰
   - å¸¸é‡ï¼šä¸‹åˆ’çº¿å‰ç¼€ï¼ˆå¦‚`_gameID`ã€`_wild`ã€`_minCount`ï¼‰

2. **æ³¨é‡Šè§„èŒƒ**
   - å…¬å¼€å‡½æ•°å¿…é¡»æœ‰æ³¨é‡Šè¯´æ˜åŠŸèƒ½
   - å¤æ‚é€»è¾‘æ·»åŠ è¡Œå†…æ³¨é‡Š
   - å¸¸é‡å®šä¹‰è¯´æ˜ç”¨é€”

3. **é”™è¯¯å¤„ç†**
   - æ‰€æœ‰å¯èƒ½å¤±è´¥çš„æ“ä½œéƒ½è¦è¿”å›error
   - å…³é”®æ“ä½œæ·»åŠ panicæ¢å¤
   - ä½¿ç”¨zapè®°å½•é”™è¯¯æ—¥å¿—

4. **æ•°æ®éªŒè¯**
   - è®¿é—®mapå‰æ£€æŸ¥keyæ˜¯å¦å­˜åœ¨
   - è®¿é—®åˆ‡ç‰‡/æ•°ç»„å‰æ£€æŸ¥ç´¢å¼•èŒƒå›´
   - éªŒè¯æ¥è‡ªç¼“å­˜/å¤–éƒ¨çš„æ•°æ®æœ‰æ•ˆæ€§
   - ä½¿ç”¨`common.Containers()`ç­‰å·¥å…·å‡½æ•°

### å¼€å‘æ³¨æ„äº‹é¡¹

#### âš ï¸ å¿…é¡»éµå®ˆçš„è§„åˆ™

1. **é˜²æ­¢Panic**
   - âŒ ç›´æ¥è®¿é—®ï¼š`s.bonusMap[s.scene.BonusNum].Multi`
   - âœ… å®‰å…¨è®¿é—®ï¼šå…ˆéªŒè¯BonusNumæœ‰æ•ˆæ€§ï¼Œå†æ£€æŸ¥mapå’Œnil

2. **æ•°ç»„è¶Šç•Œ**
   - âŒ ç›´æ¥è®¿é—®ï¼š`arr[index]`
   - âœ… è¾¹ç•Œæ£€æŸ¥ï¼š`if index < len(arr) { ... }`

3. **ç©ºæŒ‡é’ˆè®¿é—®**
   - âŒ ç›´æ¥è®¿é—®ï¼š`obj.Field`
   - âœ… nilæ£€æŸ¥ï¼š`if obj != nil { obj.Field }`

4. **å¹¶å‘å®‰å…¨**
   - ä¿®æ”¹å…±äº«æ•°æ®å‰å¿…é¡»åŠ é”
   - ä½¿ç”¨`client.BetLock`ä¿æŠ¤è®¢å•æ“ä½œ

5. **é‡‘é¢è®¡ç®—**
   - ä½¿ç”¨`decimal.Decimal`è¿›è¡Œç²¾ç¡®è®¡ç®—
   - é¿å…ä½¿ç”¨float64ç›´æ¥è®¡ç®—é‡‘é¢

6. **Redisæ•°æ®**
   - åœºæ™¯æ•°æ®å¿…é¡»è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆå½“å‰90å¤©ï¼‰
   - åºåˆ—åŒ–ä½¿ç”¨jsoniter
   - åŠ è½½åéªŒè¯æ•°æ®å®Œæ•´æ€§

7. **æ—¥å¿—è®°å½•**
   - é”™è¯¯æƒ…å†µå¿…é¡»è®°å½•æ—¥å¿—
   - ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—ï¼ˆzap.Anyï¼‰
   - è®°å½•å…³é”®å­—æ®µä¾¿äºæ’æŸ¥

#### ğŸ“‹ å¼€å‘æ£€æŸ¥æ¸…å•

- [ ] æ˜¯å¦æ·»åŠ äº†panicæ¢å¤ï¼Ÿ
- [ ] æ˜¯å¦éªŒè¯äº†å¤–éƒ¨æ•°æ®ï¼Ÿ
- [ ] æ˜¯å¦æ£€æŸ¥äº†æ•°ç»„è¶Šç•Œï¼Ÿ
- [ ] æ˜¯å¦æ£€æŸ¥äº†map keyå­˜åœ¨ï¼Ÿ
- [ ] æ˜¯å¦æ£€æŸ¥äº†nilæŒ‡é’ˆï¼Ÿ
- [ ] æ˜¯å¦ä½¿ç”¨äº†å¹¶å‘é”ï¼Ÿ
- [ ] æ˜¯å¦è®°å½•äº†é”™è¯¯æ—¥å¿—ï¼Ÿ
- [ ] æ˜¯å¦ä½¿ç”¨decimalè®¡ç®—é‡‘é¢ï¼Ÿ
- [ ] æ˜¯å¦è®¾ç½®äº†Redisè¿‡æœŸæ—¶é—´ï¼Ÿ
- [ ] æ˜¯å¦æ›´æ–°äº†å•å…ƒæµ‹è¯•ï¼Ÿ

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **ç¼“å­˜ä½¿ç”¨**
   - åœºæ™¯æ•°æ®ä½¿ç”¨Redisç¼“å­˜ï¼Œå‡å°‘æ•°æ®åº“è®¿é—®
   - é…ç½®æ•°æ®å¯åŠ¨æ—¶åŠ è½½ï¼Œé¿å…é‡å¤è§£æ

2. **å†…å­˜ç®¡ç†**
   - ä½¿ç”¨å›ºå®šå¤§å°æ•°ç»„ï¼ˆå¦‚`[20]int`ï¼‰è€Œéåˆ‡ç‰‡
   - é¿å…ä¸å¿…è¦çš„å†…å­˜åˆ†é…
   - å¤ç”¨å¯¹è±¡æ± 

3. **æ•°æ®åºåˆ—åŒ–**
   - ä½¿ç”¨jsoniterä»£æ›¿æ ‡å‡†åº“ï¼Œæ€§èƒ½æå‡2-3å€
   - é¢„åˆ†é…åˆ‡ç‰‡å®¹é‡ï¼š`make([]*winResult, 0, 20)`

4. **å¹¶å‘æ§åˆ¶**
   - ç»†ç²’åº¦é”ï¼Œå‡å°‘é”æŒæœ‰æ—¶é—´
   - é¿å…åµŒå¥—é”ï¼Œé˜²æ­¢æ­»é”

5. **æ•°æ®åº“ä¼˜åŒ–**
   - ä½¿ç”¨è¿æ¥æ± 
   - æ‰¹é‡æ“ä½œä»£æ›¿å•æ¡æ“ä½œ
   - æ·»åŠ é€‚å½“ç´¢å¼•

### æµ‹è¯•å»ºè®®

1. **å•å…ƒæµ‹è¯•**
   - è¦†ç›–æ ¸å¿ƒé€»è¾‘ï¼ˆä¸­å¥–æ£€æµ‹ã€å€æ•°è®¡ç®—ï¼‰
   - æµ‹è¯•è¾¹ç•Œæ¡ä»¶ï¼ˆç©ºæ•°ç»„ã€è¶Šç•Œã€nilï¼‰
   - æµ‹è¯•å¼‚å¸¸åœºæ™¯ï¼ˆä½™é¢ä¸è¶³ã€æ•°æ®å¼‚å¸¸ï¼‰

2. **é›†æˆæµ‹è¯•**
   - æµ‹è¯•å®Œæ•´æ¸¸æˆæµç¨‹
   - æµ‹è¯•å…è´¹æ¸¸æˆè§¦å‘å’Œç»“æŸ
   - æµ‹è¯•è¿ç»­ä¸­å¥–é€»è¾‘

3. **å‹åŠ›æµ‹è¯•**
   - å¹¶å‘ä¸‹æ³¨æµ‹è¯•
   - é•¿æ—¶é—´è¿è¡Œç¨³å®šæ€§æµ‹è¯•
   - å†…å­˜æ³„æ¼æ£€æµ‹

### è°ƒè¯•æŠ€å·§

1. **æŸ¥çœ‹åœºæ™¯æ•°æ®**
   ```bash
   redis-cli
   > GET scene-18931:ç”¨æˆ·ID
   > TTL scene-18931:ç”¨æˆ·ID
   ```

2. **æ—¥å¿—æŸ¥è¯¢**
   - ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—ä¾¿äºgrep
   - å…³é”®å­—æ®µï¼šè®¢å•å·ã€ç”¨æˆ·IDã€é”™è¯¯ç±»å‹

3. **å¸¸è§é—®é¢˜æ’æŸ¥**
   - Panic â†’ æ£€æŸ¥å †æ ˆï¼Œå®šä½nil/è¶Šç•Œè®¿é—®
   - ä½™é¢ä¸ä¸€è‡´ â†’ æ£€æŸ¥decimalè®¡ç®—å’ŒRound
   - å…è´¹æ¸¸æˆå¼‚å¸¸ â†’ æ£€æŸ¥BonusNumå’ŒBonusState

---

## ğŸ”„ ç‰ˆæœ¬å†å²

### v1.6.0 - 2025å¹´10æœˆ22æ—¥
**å¢å¼ºé”™è¯¯å¤„ç†å’Œä»£ç è´¨é‡**
- ä¿®å¤bonusMapè®¿é—®å¯èƒ½å¯¼è‡´panicçš„é—®é¢˜
- æ·»åŠ BonusNumæœ‰æ•ˆæ€§éªŒè¯ï¼ˆä½¿ç”¨`common.Containers()`ï¼‰
- å¢åŠ é”™è¯¯æ—¥å¿—è®°å½•å’Œå¼‚å¸¸æ•°æ®è‡ªåŠ¨ä¿®æ­£
- å°†å†…éƒ¨æ–¹æ³•æ”¹ä¸ºç§æœ‰ï¼ˆcheckRewardã€checkLineExç­‰ï¼‰ï¼Œæå‡ä»£ç å°è£…æ€§
- ä¼˜åŒ–`ExtraMul()`ã€`SetContinueMulti()`ã€`setPretraMul()`ç­‰æ–¹æ³•çš„å¥å£®æ€§
- å®Œå–„é˜²å¾¡æ€§ç¼–ç¨‹ï¼Œå¢å¼ºç³»ç»Ÿç¨³å®šæ€§

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ¸¸æˆè¯¦ç»†è¯´æ˜](./doc/èµé‡‘å¥³ç‹.md) - æ¸¸æˆè§„åˆ™å’Œç©æ³•
- [æ¸¸æˆé…ç½®æ–‡ä»¶](game.json) - å®Œæ•´é…ç½®æ•°æ®
- [è®¾è®¡æ–‡æ¡£](./doc/README.md) - æ¸¸æˆè®¾è®¡æ–‡æ¡£

---

## ğŸ”— æŠ€æœ¯æ ˆé“¾æ¥

- [Goè¯­è¨€](https://golang.org/)
- [gRPC](https://grpc.io/)
- [Redis](https://redis.io/)
- [MySQL](https://www.mysql.com/)
- [Zapæ—¥å¿—åº“](https://github.com/uber-go/zap)
- [jsoniter](https://github.com/json-iterator/go)
- [decimal](https://github.com/shopspring/decimal)

---

## ğŸ‘¥ ç»´æŠ¤å›¢é˜Ÿ

**å¼€å‘å›¢é˜Ÿ**: egame-grpc03é¡¹ç›®ç»„  
**æ¸¸æˆæ¨¡å—**: sjnws2 - èµé‡‘å¥³ç‹2  
**æŠ€æœ¯æ”¯æŒ**: è¯·é€šè¿‡issueæˆ–å†…éƒ¨æ¸ é“è”ç³»

---

*æœ¬æ–‡æ¡£æœ€åæ›´æ–°æ—¶é—´: 2025å¹´10æœˆ22æ—¥*

*æ–‡æ¡£ç‰ˆæœ¬: v1.6.0*
